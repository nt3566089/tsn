/*
* このソースは基盤ソースです。変更は行わないで下さい。
*/


angular.module("oneslogiWeb.base.liteLogin.LiteLoginCommon",[]).constant("SCREEN_CD_LITE_LOGIN","LiteLogin").constant("SCREEN_CD_PASSWORD_CHANGE","PasswordChange").constant("ITEM_CD_LOGIN_ID","loginId").constant("ITEM_CD_LOGIN","login").constant("ITEM_CD_PASSWORD","password").constant("ITEM_CD_OLD_PASSWORD","oldPassword").constant("ITEM_CD_NEW_PASSWORD","newPassword").constant("ITEM_CD_NEW_PASSWORD_RE_ENTER","newPasswordReEnter").constant("ITEM_CD_PASSWORD_CHANGE","passwordChange").constant("ITEM_CD_CHANCEL","cancel").constant("ITEM_CD_CLOSE_SUCCESS_MSG_DIALOG","closeSuccessMsgDialog").constant("ITEM_CD_CLOSE_WARNING_MSG_DIALOG","closeWarningMsgDialog").constant("ITEM_CD_CLOSE_DANGER_MSG_DIALOG","closeDangerMsgDialog").constant("ITEM_CD_PASSWORD_RESET","passwordReset").constant("VIEW_MODE_PASSWORD_CHANGE","PASSWORD_CHANGE").constant("VIEW_MODE_FIRST_LOGIN","FIRST_LOGIN").constant("VIEW_MODE_PASSWORD_CHANGE_BY_MGT","PASSWORD_CHANGE_BY_MGT").constant("MSG_CD_PASSWORD_CHANGE_SUCCESS","passwordChangeSuccess").constant("MSG_CD_PASSWORD_CHANGE_BY_MGT_SUCCESS","passwordChangeByMgtSuccess").constant("EVENT_NAME_PASSWORD_CHANGE_BY_MGT","EVENT_NAME_PASSWORD_CHANGE_BY_MGT").factory("LiteLoginCommonUtils",["$interval",function(a){var b=function(a,b){return["以下のエラーが発生しました。","ネットワークに接続出来るか確認して下さい。","それでも解決しない場合、以下の内容を管理者にお伝え下さい。","HttpStatus:["+a+"]  接続先:["+b.url+"]"]},c=void 0,d=function(b,d,e){angular.isDefined(c)||(c=a(b,d,e),c.then(function(){c=void 0},function(){c=void 0}))},e=function(){angular.isDefined(c)&&(a.cancel(c),c=void 0)};return{Debug:function(a){console.log(a)},Alert:function(a){alert(a)},FormatFatalLog:function(a,c){return b(a,c)},ConvertProcessErrorMessages:function(a,c,d){if(!a||!a.result||!a.result.processMessageNms)return b(c,d);if(a.result.processMessageNms&&a.result.processMessageNms.length>0){var e=[];for(i=0;i<a.result.processMessageNms.length;i++){var f=a.result.processMessageNms[i].split("[/]");for(j=0;j<f.length;j++)e.push(f[j])}return e}return b(c,d)},ConvertSuccessMessages:function(a,b){if(!a||!a.result||!a.result.messageNames)return[];if(b&&b.length>0){var c=[];for(i=0;i<b.length;i++){var d=a.result.messageNames[b[i]].split("[/]");for(j=0;j<d.length;j++)c.push(d[j])}return c}return[]},StartInterval:function(a,b,c){d(a,b,c)},StopInterval:function(){e()},SetInitialFocus:function(a,b){d(function(){if(a()){var c=document.getElementById(b);if(!c)return;c.focus();var d=document.activeElement;if(d&&d.id){if(d.id==b)return void e();return}}},300,10)}}}]),angular.module("oneslogiWeb.base.liteLogin.PasswordChange",["ui.bootstrap","oneslogiWeb.base.liteLogin.LiteLoginCommon"]).factory("PasswordChangeDialog",["$modal",function(a){var b;return{show:function(c,d,e,f){document.activeElement;b=a.open({templateUrl:"base/partials/liteLogin/PasswordChange.html",backdrop:"static",controller:"PasswordChangeCtrl",resolve:{shared:function(){return{userCd:c,gotoUrl:d,viewMode:e,cultureCd:f,widthInterruptMsg:!1}}}})},showWithInterruptMsg:function(c,d,e,f,g){document.activeElement;b=a.open({templateUrl:"base/partials/liteLogin/PasswordChange.html",backdrop:"static",controller:"PasswordChangeCtrl",resolve:{shared:function(){return{userCd:c,gotoUrl:d,viewMode:e,cultureCd:f,message:g,widthInterruptMsg:!0}}}})},setCloseEvent:function(a){b.result.finally(a)},cancel:function(){b.close()},close:function(){b.close()}}}]).controller("PasswordChangeCtrl",["$scope","$rootScope","$http","$location","shared","SCREEN_CD_PASSWORD_CHANGE","ITEM_CD_OLD_PASSWORD","ITEM_CD_NEW_PASSWORD","ITEM_CD_NEW_PASSWORD_RE_ENTER","ITEM_CD_PASSWORD_CHANGE","ITEM_CD_CHANCEL","ITEM_CD_LOGIN_ID","ITEM_CD_PASSWORD","ITEM_CD_CLOSE_SUCCESS_MSG_DIALOG","ITEM_CD_CLOSE_WARNING_MSG_DIALOG","ITEM_CD_CLOSE_DANGER_MSG_DIALOG","ITEM_CD_PASSWORD_RESET","VIEW_MODE_PASSWORD_CHANGE","VIEW_MODE_FIRST_LOGIN","VIEW_MODE_PASSWORD_CHANGE_BY_MGT","MSG_CD_PASSWORD_CHANGE_SUCCESS","MSG_CD_PASSWORD_CHANGE_BY_MGT_SUCCESS","EVENT_NAME_PASSWORD_CHANGE_BY_MGT","PasswordChangeDialog","LiteLoginCommonUtils",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(){this.title="LOADING",this.oldPassword="",this.newPassword="",this.newPasswordReEnter="",this.passwordChange="",this.cancel="",this.hasError=!1,this.errorMessages=[],this.loading=!0,this.initialized=!1,this.changedPassword=!1,this.successMessages=[],this.showPasswordResetCheck=!1,this.showOldPassword=!1,this.showSuccessMsgDialog=!1,this.showWarningMsgDialog=!1,this.showDangerMsgDialog=!1,this.closeSuccessMsgDialog="",this.closeWarningMsgDialog="",this.closeDangerMsgDialog="",this.successDialogMessages=[],this.warningDialogMessages=[],this.dangerDialogMessages=[],this.passwordRestChangeable=!1}function A(){}var B="",C=null;z.prototype={isShowContainer:function(){return this.initialized&&!this.isShowSuccessMsgDialog()&&!this.isShowWarningMsgDialog()&&!this.isShowDangerMsgDialog()},isShowSuccessMsgDialog:function(){return this.initialized&&this.showSuccessMsgDialog&&!this.showWarningMsgDialog&&!this.showDangerMsgDialog},isShowWarningMsgDialog:function(){return this.initialized&&!this.showSuccessMsgDialog&&this.showWarningMsgDialog&&!this.showDangerMsgDialog},isShowDangerMsgDialog:function(){return this.initialized&&!this.showSuccessMsgDialog&&!this.showWarningMsgDialog&&this.showDangerMsgDialog}},a.$watch("displayStructure.isShowContainer()",function(b,c){0==c&&1==b&&(e.viewMode==t?y.SetInitialFocus(function(){return a.displayStructure.initialized&&!a.displayStructure.loading},h):y.SetInitialFocus(function(){return a.displayStructure.initialized&&!a.displayStructure.loading},g))}),a.$watch("displayStructure.isShowSuccessMsgDialog()",function(a,b){0==b&&1==a&&y.SetInitialFocus(function(){return!0},n)}),a.$watch("displayStructure.isShowWarningMsgDialog()",function(a,b){0==b&&1==a&&y.SetInitialFocus(function(){return!0},o)}),a.$watch("displayStructure.isShowDangerMsgDialog()",function(a,b){0==b&&1==a&&y.SetInitialFocus(function(){return!0},p)}),A.ShowServerError=function(b,c,d,e){a.displayStructure.hasError=!0,a.displayStructure.errorMessages=y.ConvertProcessErrorMessages(b,c,e),a.displayStructure.loading=!1},A.ShowServerFatal=function(b,c,d,e){a.displayStructure.hasError=!0,a.displayStructure.errorMessages=y.FormatFatalLog(c,e),a.displayStructure.loading=!1},a.initBody=function(){B="",C=null,x.setCloseEvent(function(){window.removeEventListener("focusin",H)}),window.addEventListener("focusin",H),a.displayStructure=new z,a.input={},a.displayStructure.loading=!0,a.displayStructure.initialized=!1,a.displayStructure.showWarningMsgDialog=e.widthInterruptMsg,1==e.widthInterruptMsg&&(a.displayStructure.warningDialogMessages=e.message),e.viewMode==t?(a.displayStructure.showPasswordResetCheck=!0,a.displayStructure.showOldPassword=!1):(a.displayStructure.showPasswordResetCheck=!1,a.displayStructure.showOldPassword=!0);var b={};b.input={},b.input.viewMode=e.viewMode,b.input.cultureCd=e.cultureCd,b.input.screenCd=f,b.input.itemCds=[g,h,i,j,k,n,o,p,q],c({method:"GET",url:"resources/base/login/PasswordChange/loadDisplay",params:b}).then(function(b){var c=b.data,d=b.status,e=(b.headers,b.config);1==c.result.processStatus?(a.displayStructure.title=c.result.screenNm,a.displayStructure.oldPassword=c.result.itemDisplayNames[g],a.displayStructure.newPassword=c.result.itemDisplayNames[h],a.displayStructure.newPasswordReEnter=c.result.itemDisplayNames[i],a.displayStructure.passwordChange=c.result.itemDisplayNames[j],a.displayStructure.cancel=c.result.itemDisplayNames[k],a.displayStructure.closeSuccessMsgDialog=c.result.itemDisplayNames[n],a.displayStructure.closeWarningMsgDialog=c.result.itemDisplayNames[o],a.displayStructure.closeDangerMsgDialog=c.result.itemDisplayNames[o],a.displayStructure.passwordReset=c.result.itemDisplayNames[q],a.input.passwordReset=c.result.passwordReset,a.displayStructure.passwordRestChangeable=c.result.passwordRestChangeable,a.displayStructure.initialized=!0):(a.displayStructure.hasError=!0,a.displayStructure.errorMessages=y.ConvertProcessErrorMessages(c,d,e),a.displayStructure.loading=!1),a.displayStructure.loading=!1}).catch(function(b){var c=(b.data,b.status),d=(b.headers,b.config);a.displayStructure.hasError=!0,a.displayStructure.errorMessages=y.FormatFatalLog(c,d),a.displayStructure.loading=!1})},a.clickPasswordChange=function(){D()};var D=function(){a.displayStructure.loading=!0;var d={};d.input={},d.input.userCd=e.userCd,d.input.oldPassword=a.input.oldPassword,d.input.newPassword=a.input.newPassword,d.input.newPasswordReEnter=a.input.newPasswordReEnter,d.input.viewMode=e.viewMode,d.input.cultureCd=e.cultureCd,d.input.screenCd=f,d.input.oldPasswordItemCd=g,d.input.newPasswordItemCd=h,d.input.newPasswordReEnterItemCd=i,d.input.messageCds=[],d.input.messageCds=[u,v],d.input.passwordReset=a.input.passwordReset;var j={};j.newPassword=a.input.newPassword,a.input.oldPassword="",a.input.newPassword="",a.input.newPasswordReEnter="",a.displayStructure.hasError=!1,a.displayStructure.errorMessages=[],c({method:"POST",url:"resources/base/login/PasswordChange/change",data:d}).then(function(c){var d=c.data,f=c.status,g=c.headers,h=c.config;if(1==d.result.processStatus){var i=d.result.messageNames;e.viewMode==t?(x.setCloseEvent(function(){b.$broadcast(w)}),d.result.messageNames=i,a.displayStructure.successDialogMessages=y.ConvertSuccessMessages(d,[v]),a.displayStructure.changedPassword=!0,a.displayStructure.showSuccessMsgDialog=!0):E(j,i)}else e.viewMode==t?A.ShowServerError(d,f,g,h):"AVAILABLE_OUT_OF_PERIOD"==d.result.passwordChangeResultStatus||"BECAME_LOCKOUT"==d.result.passwordChangeResultStatus||"LOCKOUT"==d.result.passwordChangeResultStatus?(a.displayStructure.showDangerMsgDialog=!0,a.displayStructure.dangerDialogMessages=y.ConvertProcessErrorMessages(d,f,h),x.setCloseEvent(function(){location.href="resources/logout"})):A.ShowServerError(d,f,g,h)}).catch(function(a){var b=a.data,c=a.status,d=a.headers,e=a.config;A.ShowServerFatal(b,c,d,e)})},E=function(b,g){a.displayStructure.loading=!0;var i={};return i.input={},i.input.loginId=e.userCd,i.input.password=b.newPassword,i.input.screenCd=f,i.input.cultureCd=e.cultureCd,i.input.loginIdItemCd=l,i.input.passwordItemCd=h,b.newPassword="",b={},a.displayStructure.hasError=!1,a.displayStructure.errorMessages=[],c({method:"POST",url:"resources/authentication/lite/login",data:i}).then(function(b){var c=b.data,f=b.status,h=b.headers,i=b.config;1!=c.result.processStatus||"SUCCESS"!=c.result.userAuthResultStatus&&"FIRST_LOGIN"!=c.result.userAuthResultStatus?A.ShowServerFatal(c,f,h,i):(e.viewMode==r?x.setCloseEvent(function(){d.path("/#"+e.gotoUrl)}):e.viewMode==s&&x.setCloseEvent(function(){location.href=e.gotoUrl}),c.result.messageNames=g,a.displayStructure.successDialogMessages=y.ConvertSuccessMessages(c,[u]),a.displayStructure.changedPassword=!0,a.displayStructure.showSuccessMsgDialog=!0)}).catch(function(a){var b=a.data,c=a.status,d=a.headers,e=a.config;A.ShowServerError(b,c,d,e)})};a.clickCancel=function(){x.cancel()},a.clickCloseSuccessMsgDialog=function(){x.close()},a.clickCloseWarningMsgDialog=function(){a.displayStructure.showWarningMsgDialog=!1},a.clickCloseDangerMsgDialog=function(){x.close()};var F=function(a){return a.tagName?a.tagName.toLowerCase():""},G=function(a){var b=F(a);return"input"!=b&&"button"!=b||!a.id?"":a.id},H=function(b){var c=b.target;if(a.displayStructure.isShowContainer()){var d=G(c);if(""==d)return;e.viewMode==t?(null==C&&(C={},C[h]=document.getElementById(h),C[i]=document.getElementById(i),C[j]=document.getElementById(j),C[k]=document.getElementById(k),C[q]=document.getElementById(q)),null==C[d]?B==h?(C[k].focus(),B=k):B==k&&(C[h].focus(),B=h):B=d):(null==C&&(C={},C[g]=document.getElementById(g),C[h]=document.getElementById(h),C[i]=document.getElementById(i),C[j]=document.getElementById(j),C[k]=document.getElementById(k)),null==C[d]?B==g?(C[k].focus(),B=k):B==k&&(C[g].focus(),B=g):B=d)}else a.displayStructure.isShowSuccessMsgDialog()?(document.getElementById(n).focus(),B=n):a.displayStructure.isShowWarningMsgDialog()?(document.getElementById(o).focus(),B=o):a.displayStructure.isShowDangerMsgDialog()&&(document.getElementById(p).focus(),B=p)}}]),angular.module("oneslogiWeb.base.liteLogin.LiteLogin",["oneslogiWeb.base.liteLogin.LiteLoginCommon","oneslogiWeb.base.liteLogin.PasswordChange"]).controller("LiteLoginCtrl",["$scope","$http","$location","SCREEN_CD_LITE_LOGIN","ITEM_CD_LOGIN_ID","ITEM_CD_LOGIN","ITEM_CD_PASSWORD","VIEW_MODE_FIRST_LOGIN","PasswordChangeDialog","LiteLoginCommonUtils",function(a,b,c,d,e,f,g,h,i,j){function k(){this.title="",this.loginId="",this.login="",this.password="",this.system="LOADING",this.hasError=!1,this.errorMessages=[],this.loading=!0,this.initialized=!1}var l;a.initBody=function(){a.displayStructure=new k,a.displayStructure.loading=!0,a.displayStructure.initialized=!1;var c=window.navigator.userLanguage||window.navigator.language||window.navigator.browserLanguage,h={};h.condition={},h.condition.language=c,h.condition.screenCd=d,h.condition.itemCds=[e,f,g],b({method:"GET",url:"resources/base/login/LiteLoginDisplay/load",params:h}).then(function(b){var c=b.data,d=b.status,h=(b.headers,b.config);1==c.result.processStatus?(a.displayStructure.title=c.result.screenNm,a.displayStructure.loginId=c.result.itemDisplayNames[e],a.displayStructure.password=c.result.itemDisplayNames[g],a.displayStructure.login=c.result.itemDisplayNames[f],a.displayStructure.system=c.result.systemNm,l=c.result.cultureCd,a.displayStructure.initialized=!0):(a.displayStructure.hasError=!0,a.displayStructure.errorMessages=j.ConvertProcessErrorMessages(c,d,h),a.displayStructure.system=""),a.displayStructure.loading=!1,j.SetInitialFocus(function(){return a.displayStructure.initialized&&!a.displayStructure.loading},e),document.addEventListener("keydown",m)}).catch(function(b){var c=(b.data,b.status),d=(b.headers,b.config);a.displayStructure.hasError=!0,a.displayStructure.errorMessages=j.FormatFatalLog(c,d),a.displayStructure.loading=!1})},a.clickLogin=function(){a.displayStructure.loading=!0;var c={};c.input={},c.input.loginId=a.loginId,c.input.password=a.password,c.input.screenCd=d,c.input.cultureCd=l,c.input.loginIdItemCd=e,c.input.passwordItemCd=g;var f=location.search;if(null!=f&&""!=f&&f.length>1){f=f.substr(1);for(var k=f.split("&amp;"),n=0;n<k.length;n++){var o=k[n].split("=");if("goto"==decodeURIComponent(o[0])&&o.length>1){c.result={},c.result.gotoUrl=decodeURIComponent(o[1]);break}}}a.password="",a.displayStructure.hasError=!1,a.displayStructure.errorMessages=[],b({method:"POST",url:"resources/authentication/lite/login",data:c}).then(function(b){var c=b.data,d=b.status,e=(b.headers,b.config);1==c.result.processStatus?(document.removeEventListener("keydown",m),"FIRST_LOGIN"==c.result.userAuthResultStatus||"PASSWORD_EXPIRED"==c.result.userAuthResultStatus?i.showWithInterruptMsg(a.loginId,c.result.gotoUrl,h,l,j.ConvertProcessErrorMessages(c,d,e)):location.href=c.result.gotoUrl,a.displayStructure.loading=!1):(a.displayStructure.hasError=!0,a.displayStructure.errorMessages=j.ConvertProcessErrorMessages(c,d,e),a.displayStructure.loading=!1)}).catch(function(b){var c=(b.data,b.status),d=(b.headers,b.config);a.displayStructure.hasError=!0,a.displayStructure.errorMessages=j.FormatFatalLog(c,d),a.displayStructure.loading=!1})};var m=function(b){if(13==b.keyCode){var c=document.activeElement;c&&c.id&&(c.id==e?document.getElementById(g).focus():c.id==g&&a.clickLogin())}}}]);