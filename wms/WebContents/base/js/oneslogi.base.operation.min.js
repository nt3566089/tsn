/*
* このソースは基盤ソースです。変更は行わないで下さい。
*/


angular.module("oneslogiWeb.LogDtlBrowse",[]).factory("LogDtlBrowseModalService",["$rootScope","$q","$modal","alertMessage",function($rootScope,$q,$modal,alertMessage){var _modal,_callerSelectedItem,_callerColumnDefs;return{displayModal:function(selectedItem,columnDefs){_callerSelectedItem=selectedItem,_callerColumnDefs=columnDefs;var elmFocus=document.activeElement;_modal=$modal.open({templateUrl:"base/partials/operation/LogDtlBrowse.html",backdrop:"static",controller:"LogDtlBrowseController",resolve:{getScreen:["owsScreen",function(owsScreen){return new owsScreen.getData("LogDtlBrowse",!0)}],getItem:["owsItem",function(owsItem){return new owsItem.getData("LogDtlBrowse")}]},windowClass:"app-modal-window",beforeClose:function(){alertMessage.removeModalAlert("LogDtlBrowse"),elmFocus.focus()},beforeDismiss:function(){alertMessage.removeModalAlert("LogDtlBrowse"),elmFocus.focus()}}),_modal.opened.then(function(){alertMessage.addModalAlert(_modal,"LogDtlBrowse")})},closeModal:function(){_modal.close()},getCallerSelectedItem:function(){return _callerSelectedItem},getCallerColumnDefs:function(){return _callerColumnDefs}}}]).factory("LogDtlBrowseApi",["AngularAPIClient",function(AngularAPIClient){return{LogDtlBrowse:AngularAPIClient.make([["selectLogDtlByLogDtlId","GET","resources/base/operation/LogDtlBrowse/selectLogDtlByLogDtlId"]])}}]).controller("LogDtlBrowseController",["$scope","$q","owsCommon","LogDtlBrowseModalService","LogDtlBrowseApi",function($scope,$q,owsCommon,logDtlBrowseModalService,api){var initScreen=function(){var windowHeight=parseInt($(window).height());$scope.displayAreaHeight=windowHeight-windowHeight/20*7;for(var callerColumnDefs=logDtlBrowseModalService.getCallerColumnDefs(),i=0;i<callerColumnDefs.length;i++)"bclassDtlByLogDtlStatus.vdict.dictNm"==callerColumnDefs[i].field?$scope.bclassDtlByLogDtlStatusFieldDisplayName=callerColumnDefs[i].displayName:"processDt"==callerColumnDefs[i].field?$scope.processDtFieldDisplayName=callerColumnDefs[i].displayName:"logDtlSectionNm"==callerColumnDefs[i].field?$scope.logDtlSectionNmFieldDisplayName=callerColumnDefs[i].displayName:"processInfo"==callerColumnDefs[i].field&&($scope.processInfoFieldDisplayName=callerColumnDefs[i].displayName);deferredGetInitData()},deferredGetInitData=function(){var deferred=$q.defer(),request={};return request.logId=logDtlBrowseModalService.getCallerSelectedItem().logId,request.logDtlId=logDtlBrowseModalService.getCallerSelectedItem().logDtlId,request.alternateSpaceString=" ",request.alternateTabString="    ",api.LogDtlBrowse.selectLogDtlByLogDtlId(request).then(function(response){$scope.logDtlProcessInfoLines=response.data.logDtlProcessInfoLines,$scope.bclassDtlByLogDtlStatusValue=response.data.bLogDtlDto.bclassDtlByLogDtlStatus.vdict.dictNm,$scope.processDtValue=response.data.bLogDtlDto.processDt,$scope.logDtlSectionNmValue=response.data.bLogDtlDto.logDtlSectionNm,deferred.resolve()}),deferred.promise};$scope.close=function(){logDtlBrowseModalService.closeModal()},initScreen()}]),angular.module("oneslogiWeb.LogDtlList",[]).factory("LogDtlListApi",["AngularAPIClient",function(AngularAPIClient){return{LogDtlList:AngularAPIClient.make([["initSearch","GET","resources/base/operation/LogDtlList/initSearch"],["initPageSearch","GET","resources/base/operation/LogDtlList/initPageSearch"]])}}]).controller("LogDtlList",["$scope","$route","$filter","$location","$q","alertMessage","directiveControl","gridDirectiveControl","optionMessageControl","gridOptionMessageControl","owsHistory","owsCommon","userInfo","statusInfo","modalFactory","LogDtlListApi","LogDtlBrowseModalService",function($scope,$route,$filter,$location,$q,alertMessage,directiveControl,gridDirectiveControl,optionMessageControl,gridOptionMessageControl,owsHistory,owsCommon,userInfo,statusInfo,modalFactory,api,logDtlBrowseModalService){$scope.logDtlListCols=[{field:"bclassDtlByLogDtlStatus.vdict.dictNm",displayName:"ログ明細ステータス"},{field:"processDt",displayName:"処理日時"},{field:"logDtlSectionNm",displayName:"ログ明細セクション名称"},{field:"processInfo",displayName:"処理情報"}],$scope.initScreen=function(){$scope.pagingOptions=owsCommon.getDefaultPagingOptions();var setPageData=function(){$scope.getPagingData($scope.gridOptions.paginationPageSize,$scope.gridOptions.paginationCurrentPage)};$scope.pagingOptions.setPageData=setPageData,$scope.pagingOptions.setPageDataWhenPageSizeChanged=setPageData,$scope.pgmCd=userInfo.pgmCd,$scope.pgmNm=userInfo.pgmNm,$scope.gridOptions=owsCommon.mergePagingSingleSelectGridOptions({data:"logDtlList",columnDefs:"logDtlListCols",pagingOptions:$scope.pagingOptions}),$scope.deferredGetInitData()},$scope.deferredGetInitData=function(){var deferred=$q.defer(),request={};return request.logId=$route.current.params.logId,request.pgmCd=$route.current.params.pgmCd,request.pgmNm=$route.current.params.pgmNm,api.LogDtlList.initSearch(request).then(function(response){return statusInfo.isSuccessAndShowMessage(response,"searchform")?($scope.paging=response.paging,$scope.searchCondition=response.data.head,$scope.logDtlList=response.data.list,$scope.setPagingData(response,$scope.gridOptions.paginationCurrentPage,$scope.gridOptions.paginationPageSize),owsHistory.hasState()&&($scope.searchCondition=owsHistory.popState(),$scope.getPagingData($scope.gridOptions.paginationPageSize,$scope.gridOptions.paginationCurrentPage)),void deferred.resolve()):(owsCommon.viewInfoAndHistoryBack(response.status.messageCode,response.status.messageReplaceValue),void deferred.reject())}),deferred.promise},$scope.getPagingData=function(pageSize,page){var request={};request.data={},request.data.head=$scope.searchCondition,owsCommon.setPagingData(request,$scope.paging,pageSize,page),api.LogDtlList.initPageSearch(request).then(function(response){statusInfo.isSuccessAndShowMessage(response,"searchform"),$scope.setPagingData(response,page,pageSize)})},$scope.setPagingData=function(response,page,pageSize){owsCommon.toggleSelectAll($scope.gridOptions,!1),$scope.logDtlList=response.data.list,$scope.gridOptions.totalItems=response.paging.allRecordCount,owsHistory.replaceState($scope.searchCondition)},$scope.logDtlBrowse=function(){logDtlBrowseModalService.displayModal($scope.gridOptions.gridApi.selection.getSelectedRows()[0],$scope.gridOptions.columnDefs)},$scope.gridDblClick=function(row){owsCommon.syncButtonExec("logDtlBrowse",row)},$scope.initScreen()}]),angular.module("oneslogiWeb.LogList",[]).factory("logListApi",["AngularAPIClient",function(AngularAPIClient){return{dropdownList:AngularAPIClient.make([["query","GET","resources/class/keyValueList"]]),getCenterCd:AngularAPIClient.make([["query","GET","resources/common/centerCd/keyValueList"]]),getClientCd:AngularAPIClient.make([["query","GET","resources/common/clientCd/keyValueList"]]),logList:AngularAPIClient.make([["init","GET","resources/base/operation/logList/init"],["search","GET","resources/base/operation/logList/search"],["excel","GET","resources/base/operation/logList/search","excel"]])}}]).controller("LogList",["$scope","$interval","$route","$filter","$location","$q","alertMessage","directiveControl","gridDirectiveControl","optionMessageControl","gridOptionMessageControl","owsHistory","owsCommon","userInfo","statusInfo","modalFactory","logListApi",function($scope,$interval,$route,$filter,$location,$q,alertMessage,directiveControl,gridDirectiveControl,optionMessageControl,gridOptionMessageControl,owsHistory,owsCommon,userInfo,statusInfo,modalFactory,api){$scope.logListCols=[{field:"dictNm",displayName:"ログステータス"},{field:"processStartDt",displayName:"処理開始日時"},{field:"processEndDt",displayName:"処理終了日時"},{field:"logGroupCd",displayName:"ロググループCD"},{field:"logGroupNm",displayName:"ロググループ名称"},{field:"pgmCd",displayName:"プログラムCD"},{field:"pgmNm",displayName:"プログラム名称"},{field:"attribute1",displayName:"センタCD"},{field:"centerNm",displayName:"センタ名称"},{field:"attribute2",displayName:"荷主CD"},{field:"clientNm",displayName:"荷主名称"},{field:"attribute3",displayName:"属性３CD"},{field:"attribute3Nm",displayName:"属性３名称"},{field:"attribute4",displayName:"属性４CD"},{field:"attribute4Nm",displayName:"属性４名称"},{field:"attribute5",displayName:"属性５CD"},{field:"attribute5Nm",displayName:"属性５名称"}],$scope.initScreen=function(){$scope.screenMode=$route.current.params.mode,$scope.isopen=!0,$scope.fromToCheck=function(fromValue,toValue){var fromValueString=owsCommon.dateToString(fromValue),toValueString=owsCommon.dateToString(toValue);return!(null!=fromValueString&&fromValueString.length>0&&null!=toValueString&&toValueString.length>0&&fromValueString>toValueString)},$scope.fromToMessage=$filter("owfMessage")(FROM_TO_MESSAGE_CD),$scope.clientList=userInfo.clientList,$scope.centerList=userInfo.centerList,$scope.pagingOptions=owsCommon.getDefaultPagingOptions(),$scope.pagingOptions.setPageData=function(){$scope.getPagedDataAsync($scope.gridOptions.paginationPageSize,$scope.gridOptions.paginationCurrentPage)},$scope.gridOptions=owsCommon.mergePagingSingleSelectGridOptions({data:"logList",columnDefs:"logListCols",pagingOptions:$scope.pagingOptions}),$scope.initScreenHttp()},$scope.initScreenHttp=function(){$q.all([$scope.deferredGetLogStatus(),$scope.deferredGetAttribute1(),$scope.deferredGetAttribute2(),$scope.deferredGetAttribute3(),$scope.deferredGetAttribute4(),$scope.deferredGetAttribute5()]).then(function(response){return $scope.deferredGetInitData()})},$scope.excelOutput=function(){var request={};request.data={},request.data.head=$scope.head,owsCommon.setOutputOptions(request,$scope.gridOptions,"body",document.title),api.logList.excel(request).then(function(response){statusInfo.isSuccessAndShowMessage(response,"searchinputform")?location.href=response.output.downloadUrl:$scope.setSearchData(response)})},$scope.deferredGetLogStatus=function(){var deferred=$q.defer(),request={};return request.classCd="LOG_STATUS",api.dropdownList.query(request).then(function(response){$scope.logStatusList=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetAttribute1=function(){var deferred=$q.defer(),request={};return request.classCd="ATTRIBUTE1",api.dropdownList.query(request).then(function(response){$scope.attribute1List=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetAttribute2=function(){var deferred=$q.defer(),request={};return request.classCd="ATTRIBUTE2",api.dropdownList.query(request).then(function(response){$scope.attribute2List=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetAttribute3=function(){var deferred=$q.defer(),request={};return request.classCd="ATTRIBUTE3",api.dropdownList.query(request).then(function(response){$scope.attribute3List=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetAttribute4=function(){var deferred=$q.defer(),request={};return request.classCd="ATTRIBUTE4",api.dropdownList.query(request).then(function(response){$scope.attribute4List=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetAttribute5=function(){var deferred=$q.defer(),request={};return request.classCd="ATTRIBUTE5",api.dropdownList.query(request).then(function(response){$scope.attribute5List=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetInitData=function(){var deferred=$q.defer();return api.logList.init().then(function(response){$scope.head=response.data.head,$scope.logList=response.data.body,$scope.paging=response.paging;var myDate=new Date,now=myDate.getFullYear()+(myDate.getMonth()+1<10?"0":"")+(myDate.getMonth()+1)+(myDate.getDate()<10?"0":"")+myDate.getDate();$scope.head.attribute2=userInfo.clientCd,$scope.head.attribute1=userInfo.centerCd,$scope.head.processDtFrom=now,$scope.head.processDtTo=now,owsHistory.hasState()&&($scope.head=owsHistory.popState(),$scope.getPagedDataAsync($scope.gridOptions.paginationPageSize,$scope.gridOptions.paginationCurrentPage)),owsCommon.setFirstFocus(),deferred.resolve()}),deferred.promise};var searchFlg;$scope.search=function(){owsCommon.clearPagingOptions($scope.gridOptions),$scope.getPagedDataAsync($scope.gridOptions.paginationPageSize,$scope.gridOptions.paginationCurrentPage),searchFlg="1";var request=$scope.searchinputform.chk;"1"==request&&$scope.fight()},$scope.getPagedDataAsync=function(pageSize,page){var request={};request.data={},request.data.head=$scope.head,owsCommon.setPagingData(request,$scope.paging,pageSize,page),api.logList.search(request).then(function(response){statusInfo.isSuccessAndShowMessage(response,"searchinputform"),$scope.setPagingData(response,page,pageSize)})},$scope.setPagingData=function(response,page,pageSize){owsCommon.toggleSelectAll($scope.gridOptions,!1),$scope.gridOptions.gridViewport.scrollTop(0),$scope.logList=response.data.body,$scope.gridOptions.totalItems=response.paging.allRecordCount,owsHistory.replaceState($scope.head)};var stop;$scope.chk=function(){var request=$scope.searchinputform.chk;"0"==request&&$scope.stopFight(),"1"==searchFlg&&"1"==request&&$scope.fight()},$scope.fight=function(){angular.isDefined(stop)||(stop=$interval(function(){$scope.search()},6e4,0))},$scope.stopFight=function(){angular.isDefined(stop)&&($interval.cancel(stop),stop=void 0)},$scope.gridDblClick=function(row){owsCommon.syncButtonExec("detail",row)},$scope.getClassForRow=function(row){return"1"==row.entity.delFlg?"baselegendred":""},$scope.detail=function(){$location.path("base/operation/LogDtlList").search({}).search("logId",$scope.gridOptions.gridApi.selection.getSelectedRows()[0].logId).search("pgmCd",$scope.gridOptions.gridApi.selection.getSelectedRows()[0].pgmCd).search("pgmNm",$scope.gridOptions.gridApi.selection.getSelectedRows()[0].pgmNm)},$scope.initScreen(),$scope.$on("$destroy",function(){$scope.stopFight()})}]),angular.module("oneslogiWeb.Operation",["oneslogiWeb.LogList","oneslogiWeb.LogDtlList","oneslogiWeb.LogDtlBrowse","oneslogiWeb.PrintRequestList","oneslogiWeb.PrintRequestHistList","oneslogiWeb.PrintRequestHistBrowse"]),angular.module("oneslogiWeb.PrintRequestHistBrowse",[]).constant("SCREEN_CD_PRINT_REQUEST_HIST_BROWSE","PrintRequestHistBrowse").constant("CTRL_NM_PRINT_REQUEST_HIST_BROWSE","PrintRequestHistBrowseController").constant("FORM_NM_PRINT_REQUEST_HIST_BROWSE","searchform").constant("TEMPLATE_URL_PRINT_REQUEST_HIST_BROWSE","base/partials/operation/PrintRequestHistBrowse.html").constant("VIEW_MODE_LATEST","1").constant("VIEW_MODE_BY_HIST_ID","2").factory("PrintRequestHistBrowseModalService",["$rootScope","$q","$modal","alertMessage","SCREEN_CD_PRINT_REQUEST_HIST_BROWSE","CTRL_NM_PRINT_REQUEST_HIST_BROWSE","FORM_NM_PRINT_REQUEST_HIST_BROWSE","TEMPLATE_URL_PRINT_REQUEST_HIST_BROWSE","VIEW_MODE_LATEST","VIEW_MODE_BY_HIST_ID",function($rootScope,$q,$modal,alertMessage,SCREEN_CD,CTRL_NM,FORM_NM,TEMPLATE_URL,VIEW_MODE_LATEST,VIEW_MODE_BY_HIST_ID){var _modal,_callerSelectedItem,_viewMode,displayModal=function(selectedItem,viewMode){_callerSelectedItem=selectedItem,_viewMode=viewMode;var elmFocus=document.activeElement;_modal=$modal.open({templateUrl:TEMPLATE_URL,backdrop:"static",controller:CTRL_NM,resolve:{getScreen:["owsScreen",function(owsScreen){return new owsScreen.getData(SCREEN_CD,!0)}],getItem:["owsItem",function(owsItem){return new owsItem.getData(SCREEN_CD)}]},windowClass:"app-modal-window",beforeClose:function(){alertMessage.removeModalAlert(SCREEN_CD),elmFocus.focus()},beforeDismiss:function(){alertMessage.removeModalAlert(SCREEN_CD),elmFocus.focus()}}),_modal.opened.then(function(){alertMessage.addModalAlert(_modal,SCREEN_CD)})};return{displayModalModeLatest:function(selectedItem){displayModal(selectedItem,VIEW_MODE_LATEST)},displayModalModeByHistId:function(selectedItem){displayModal(selectedItem,VIEW_MODE_BY_HIST_ID)},closeModal:function(){_modal.close()},getCallerSelectedItem:function(){return _callerSelectedItem},getViewMode:function(){return _viewMode}}}]).factory("PrintRequestHistBrowseApi",["AngularAPIClient",function(AngularAPIClient){return{PrintRequestHistBrowse:AngularAPIClient.make([["getPrintRequestHistLatest","GET","resources/base/operation/PrintRequestHistBrowse/getPrintRequestHistLatest"],["getPrintRequestHistByHistId","GET","resources/base/operation/PrintRequestHistBrowse/getPrintRequestHistByHistId"]])}}]).controller("PrintRequestHistBrowseController",["$scope","$q","owsCommon","owsItem","statusInfo","SCREEN_CD_PRINT_REQUEST_HIST_BROWSE","CTRL_NM_PRINT_REQUEST_HIST_BROWSE","FORM_NM_PRINT_REQUEST_HIST_BROWSE","TEMPLATE_URL_PRINT_REQUEST_HIST_BROWSE","VIEW_MODE_LATEST","VIEW_MODE_BY_HIST_ID","PrintRequestHistBrowseModalService","PrintRequestHistBrowseApi",function($scope,$q,owsCommon,owsItem,statusInfo,SCREEN_CD,CTRL_NM,FORM_NM,TEMPLATE_URL,VIEW_MODE_LATEST,VIEW_MODE_BY_HIST_ID,modalService,api){var initScreen=function(){var viewModel={};viewModel.printRequestNo={itemNm:"",value:""},viewModel.printerNm={itemNm:"",value:""},viewModel.trayNm={itemNm:"",value:""},viewModel.printNum={itemNm:"",value:""},viewModel.sheetCollate={itemNm:"",value:""},viewModel.printResultClass={itemNm:"",value:""},viewModel.printDt={itemNm:"",value:""},viewModel.queueAddDt={itemNm:"",value:""},viewModel.processInfo={itemNm:"",value:""},viewModel.printRequestNo.itemNm=$scope.item[SCREEN_CD].printRequestNo.itemNm,viewModel.printerNm.itemNm=$scope.item[SCREEN_CD].printerNm.itemNm,viewModel.trayNm.itemNm=$scope.item[SCREEN_CD].trayNm.itemNm,viewModel.printNum.itemNm=$scope.item[SCREEN_CD].printNum.itemNm,viewModel.sheetCollate.itemNm=$scope.item[SCREEN_CD].sheetCollate.itemNm,viewModel.printResultClass.itemNm=$scope.item[SCREEN_CD].printResult.itemNm,viewModel.printDt.itemNm=$scope.item[SCREEN_CD].printDt.itemNm,viewModel.queueAddDt.itemNm=$scope.item[SCREEN_CD].queueAddDt.itemNm,viewModel.processInfo.itemNm=$scope.item[SCREEN_CD].processInfo.itemNm,$scope.viewModel=viewModel;var windowHeight=parseInt($(window).height());$scope.displayAreaHeight=windowHeight-windowHeight/18*7,modalService.getViewMode()==VIEW_MODE_LATEST?deferredGetInitDataLatest():deferredGetInitDataByHistId()},deferredGetInitDataLatest=function(){var deferred=$q.defer(),request={};return request.printRequestId=modalService.getCallerSelectedItem().printRequestId,request.alternateSpaceString=" ",request.alternateTabString="    ",api.PrintRequestHistBrowse.getPrintRequestHistLatest(request).then(function(response){return statusInfo.isSuccessAndShowMessage(response,FORM_NM)?($scope.viewModel.printRequestNo.value=response.data.pPrintRequestHist.printRequestNo,$scope.viewModel.printerNm.value=response.data.pPrintRequestHist.printerNm,$scope.viewModel.trayNm.value=response.data.pPrintRequestHist.trayNm,$scope.viewModel.printNum.value=response.data.pPrintRequestHist.printNum,null!=response.data.pPrintRequestHist.sheetCollate?$scope.viewModel.sheetCollate.value=response.data.pPrintRequestHist.bclassDtlBySheetCollate.vdict.dictNm:$scope.viewModel.sheetCollate.value=null,$scope.viewModel.printResultClass.value=response.data.pPrintRequestHist.bclassDtlByPrintResultClass.vdict.dictNm,$scope.viewModel.printDt.value=response.data.pPrintRequestHist.printDt,$scope.viewModel.queueAddDt.value=response.data.pPrintRequestHist.queueAddDt,$scope.viewModel.processInfo.value="",$scope.processInfoLines=response.data.processInfoLines,void deferred.resolve()):void deferred.reject()}),deferred.promise},deferredGetInitDataByHistId=function(){var deferred=$q.defer(),request={};return request.printRequestHistId=modalService.getCallerSelectedItem().printRequestHistId,request.alternateSpaceString=" ",request.alternateTabString="    ",api.PrintRequestHistBrowse.getPrintRequestHistByHistId(request).then(function(response){return statusInfo.isSuccessAndShowMessage(response,FORM_NM)?($scope.viewModel.printRequestNo.value=response.data.pPrintRequestHist.printRequestNo,$scope.viewModel.printerNm.value=response.data.pPrintRequestHist.printerNm,$scope.viewModel.trayNm.value=response.data.pPrintRequestHist.trayNm,$scope.viewModel.printNum.value=response.data.pPrintRequestHist.printNum,null!=response.data.pPrintRequestHist.sheetCollate?$scope.viewModel.sheetCollate.value=response.data.pPrintRequestHist.bclassDtlBySheetCollate.vdict.dictNm:$scope.viewModel.sheetCollate.value=null,$scope.viewModel.printResultClass.value=response.data.pPrintRequestHist.bclassDtlByPrintResultClass.vdict.dictNm,$scope.viewModel.printDt.value=response.data.pPrintRequestHist.printDt,$scope.viewModel.queueAddDt.value=response.data.pPrintRequestHist.queueAddDt,$scope.viewModel.processInfo.value="",$scope.processInfoLines=response.data.processInfoLines,void deferred.resolve()):void deferred.reject()}),deferred.promise};$scope.close=function(){modalService.closeModal()},initScreen()}]),angular.module("oneslogiWeb.PrintRequestHistList",[]).factory("printRequestHistListApi",["AngularAPIClient",function(AngularAPIClient){return{printRequestHistList:AngularAPIClient.make([["initSearch","GET","resources/base/operation/printRequestHistList/initSearch"],["search","GET","resources/base/operation/printRequestHistList/search"]])}}]).controller("PrintRequestHistList",["$scope","$route","$filter","$location","$q","alertMessage","directiveControl","gridDirectiveControl","optionMessageControl","gridOptionMessageControl","owsHistory","owsCommon","userInfo","statusInfo","modalFactory","printRequestHistListApi","PrintRequestHistBrowseModalService",function($scope,$route,$filter,$location,$q,alertMessage,directiveControl,gridDirectiveControl,optionMessageControl,gridOptionMessageControl,owsHistory,owsCommon,userInfo,statusInfo,modalFactory,api,printRequestHistBrowseModalService){$scope.PrintRequestHistListCols=[{field:"printNo",displayName:"帳票"},{field:"printerNm",displayName:"プリンタ"},{field:"trayNm",displayName:"トレイ"},{field:"printNum",displayName:"部数"},{field:"sheetCollate",displayName:"部単位印刷要否"},{field:"printResultClass",displayName:"印刷結果"},{field:"printDt",displayName:"印刷日時"}],$scope.initScreen=function(){$scope.isopen=!0,$scope.pagingOptions=owsCommon.getDefaultPagingOptions();var setPageData=function(){$scope.getSearchData($scope.gridOptions.paginationPageSize,$scope.gridOptions.paginationCurrentPage)};$scope.pagingOptions.setPageData=setPageData,$scope.pagingOptions.setPageDataWhenPageSizeChanged=setPageData,$scope.gridOptions=owsCommon.mergePagingSingleSelectGridOptions({data:"printRequestHistList",columnDefs:"PrintRequestHistListCols",pagingOptions:$scope.pagingOptions}),$scope.printRequestHistList=[],$scope.initScreenHttp()},$scope.initScreenHttp=function(){return $scope.deferredGetInitData()},$scope.deferredGetInitData=function(){var deferred=$q.defer(),request={};return request.printRequestId=$route.current.params.printRequestId,api.printRequestHistList.initSearch(request).then(function(response){return statusInfo.isSuccessAndShowMessage(response,"searchinputform")?($scope.head=response.data.head,$scope.paging=response.paging,$scope.setSearchData(response),owsCommon.setFirstFocus(),void deferred.resolve()):void deferred.reject()}),deferred.promise},$scope.getSearchData=function(pageSize,page){var request={};request.data={},request.data.head=$scope.head,owsCommon.setPagingData(request,$scope.paging,pageSize,page),api.printRequestHistList.search(request).then(function(response){statusInfo.isSuccessAndShowMessage(response,"searchform"),$scope.setSearchData(response)})},$scope.setSearchData=function(response){$scope.gridOptions.gridViewport.scrollTop(0),$scope.printRequestHistList=response.data.body,$scope.gridOptions.totalItems=response.paging.allRecordCount},$scope.getClassForRow=function(row){return"1"==row.entity.delFlg?"baselegendred":""},$scope.printRequestHistBrowse=function(){printRequestHistBrowseModalService.displayModalModeByHistId($scope.gridOptions.gridApi.selection.getSelectedRows()[0])},$scope.gridDblClick=function(row){owsCommon.syncButtonExec("printRequestHistBrowse",row)},$scope.initScreen()}]),angular.module("oneslogiWeb.PrintRequestList",[]).factory("printRequestListApi",["AngularAPIClient",function(AngularAPIClient){return{keyValueList:AngularAPIClient.make([["query","GET","resources/class/keyValueList"]]),reportList:AngularAPIClient.make([["query","GET","resources/common/reportCD/keyValueList"]]),reportLayout:AngularAPIClient.make([["dropDownList","GET","resources/common/reportLayout/dropDownList"]]),printerGroup:AngularAPIClient.make([["selectAll","GET","resources/common/printerGroup/selectAll"]]),printRequestList:AngularAPIClient.make([["init","GET","resources/base/master/printRequestList/init"],["search","POST","resources/base/master/printRequestList/search"],["inputCheck","POST","resources/base/master/printRequestList/inputCheck"],["register","POST","resources/base/master/printRequestList/register"]])}}]).controller("PrintRequestList",["$scope","$route","$filter","$location","$q","alertMessage","directiveControl","gridDirectiveControl","optionMessageControl","gridOptionMessageControl","owsHistory","owsCommon","userInfo","statusInfo","printFactory","printRequestListApi","PrintRequestHistBrowseModalService",function($scope,$route,$filter,$location,$q,alertMessage,directiveControl,gridDirectiveControl,optionMessageControl,gridOptionMessageControl,owsHistory,owsCommon,userInfo,statusInfo,printFactory,api,printRequestHistBrowseModalService){$scope.PrintRequestListCols=[{field:"reportNm",displayName:"帳票名"},{field:"reportLayoutNm",displayName:"帳票レイアウト名称"},{field:"printerGroupNm",displayName:"プリンタグループ"},{field:"printStatusNm",displayName:"印刷ステータス"},{field:"printedFlgNm",displayName:"再印刷有無"},{field:"printerNm",displayName:"プリンタ名称"},{field:"printNum",displayName:"部数"},{field:"sheetCollateNm",displayName:"部単位印刷要否"},{field:"latestPrintDt",displayName:"印刷日時"}];var formCtl;$scope.putForm=function(_formCtl){formCtl=_formCtl},$scope.initScreen=function(){$scope.isopen=!0,$scope.pagingOptions=owsCommon.getDefaultPagingOptions(),$scope.pagingOptions.setPageData=function(){$scope.getSearchData()},$scope.gridOptions=owsCommon.mergePagingSingleSelectGridOptions({data:"printRequestList",columnDefs:"PrintRequestListCols",pagingOptions:$scope.pagingOptions}),$scope.initScreenHttp()},$scope.initScreenHttp=function(){$q.all([$scope.deferredGetReportList(),$scope.deferredGetPrinterGroup(),$scope.deferredGetClass("PRINT_STATUS","printStatusList"),$scope.deferredGetClass("PRINTED_FLG","printedFlgList"),$scope.deferredGetClass("PRINT_ERROR_FLG","errorFlgList"),$scope.deferredGetClass("PRINT_DATA_TYPE","printDataTypeList")]).then(function(response){return $scope.deferredGetInitData()})},$scope.deferredGetClass=function(classCd,listName){var deferred=$q.defer(),request={};return request.classCd=classCd,api.keyValueList.query(request).then(function(response){$scope[listName]=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetReportList=function(){var deferred=$q.defer(),request={};return api.reportList.query(request).then(function(response){$scope.reportList=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetPrinterGroup=function(){var deferred=$q.defer(),request={};return api.printerGroup.selectAll(request).then(function(response){$scope.printerGroupList=response.data,deferred.resolve()}),deferred.promise},$scope.deferredGetInitData=function(){var deferred=$q.defer(),request={};return request.data={},request.data.head=$scope.head,request.data.body=$scope.printRequestList,api.printRequestList.init(request).then(function(response){if(!statusInfo.isSuccessAndShowMessage(response,"searchinputform"))return void deferred.reject();$scope.head=response.data.head,$scope.printRequestList=response.data.body,$scope.blankRow=response.data.blankRow,$scope.paging=response.paging;var myDate=new Date,now=myDate.getFullYear()+(myDate.getMonth()+1<10?"0":"")+(myDate.getMonth()+1)+(myDate.getDate()<10?"0":"")+myDate.getDate();$scope.head.queueAddDtFromYmd=now,$scope.head.queueAddDtToYmd=now,owsHistory.hasState()&&($scope.head=owsHistory.popState(),$scope.getSearchData()),owsCommon.setFirstFocus(),deferred.resolve()}),deferred.promise},$scope.getClassForRow=function(row){return"1"==row.entity.delFlg?"baselegendred":""},$scope.search=function(){owsCommon.clearPagingOptions($scope.gridOptions),$scope.getSearchData()},$scope.getSearchData=function(){var request={};request.data={},request.data.head={},angular.copy($scope.head,request.data.head),!isNullOrEmpty($scope.head.queueAddDtFromYmd)&&isNullOrEmpty($scope.head.queueAddDtFromTime)&&(request.data.head.queueAddDtFromTime="00:00"),!isNullOrEmpty($scope.head.queueAddDtToYmd)&&isNullOrEmpty($scope.head.queueAddDtToTime)&&(request.data.head.queueAddDtToTime="23:59"),owsCommon.setPagingData(request,$scope.paging,$scope.gridOptions.paginationPageSize,$scope.gridOptions.paginationCurrentPage),api.printRequestList.search(request).then(function(response){statusInfo.isSuccessAndShowMessage(response,"searchinputform"),$scope.setSearchData(response)})},$scope.setSearchData=function(response){owsCommon.toggleSelectAll($scope.gridOptions,!1),$scope.gridOptions.gridViewport.scrollTop(0),$scope.printRequestList=response.data.body,$scope.gridOptions.totalItems=response.paging.allRecordCount,owsHistory.replaceState($scope.head)},$scope.changeReport=function(){if(null==$scope.head||null==$scope.head.reportCd)return void($scope.reportLayoutList=[]);var request={};request.reportCd=$scope.head.reportCd,api.reportLayout.dropDownList(request).then(function(response){$scope.reportLayoutList=response.data})},$scope.printRequestHistList=function(){$location.path("base/operation/PrintRequestHistList").search({}).search("printRequestId",$scope.gridOptions.gridApi.selection.getSelectedRows()[0].printRequestId)},$scope.gridDblClick=function(row){owsCommon.syncButtonExec("printRequestHistList",row)};var isNullOrEmpty=function(value){return null==value||""==value},checkFromTo=function(){if(!isNullOrEmpty($scope.head.queueAddDtFromYmd)&&!isNullOrEmpty($scope.head.queueAddDtToYmd)&&formCtl.queueAddDtFromYmdform.$valid&&formCtl.queueAddDtFromTimeform.$valid&&formCtl.queueAddDtToYmdform.$valid&&formCtl.queueAddDtToTimeform.$valid){var fromOrig=$scope.head.queueAddDtFromYmd;fromOrig+=isNullOrEmpty($scope.head.queueAddDtFromTime)?"00:00":$scope.head.queueAddDtFromTime;var toOrig=$scope.head.queueAddDtToYmd;toOrig+=isNullOrEmpty($scope.head.queueAddDtToTime)?"23:59":$scope.head.queueAddDtToTime,fromDate=fromOrig.replace(/:/g,""),toDate=toOrig.replace(/:/g,""),fromDate>toDate?optionMessageControl.show($scope,"queueAddDtToYmd",$filter("owfMessage")("inputLimitCheckReversalError")):(optionMessageControl.hide($scope,"queueAddDtFromYmd"),optionMessageControl.hide($scope,"queueAddDtToYmd"))}};$scope.changeQueueAddDtFromYmd=function(){isNullOrEmpty($scope.head.queueAddDtFromYmd)&&!isNullOrEmpty($scope.head.queueAddDtFromTime)?(optionMessageControl.hide($scope,"queueAddDtFromYmd"),optionMessageControl.show($scope,"queueAddDtFromYmd",$filter("owfMessage")("queueAddDtConditionallyRequiredError",[$scope.item[$scope.screenCd].queueAddDtFromTime.itemNm]))):(optionMessageControl.hide($scope,"queueAddDtFromYmd"),optionMessageControl.hide($scope,"queueAddDtFromTime"),owsCommon.syncExec(function(){checkFromTo()}))},$scope.changeQueueAddDtFromTime=function(){$scope.changeQueueAddDtFromYmd()},$scope.changeQueueAddDtToYmd=function(){isNullOrEmpty($scope.head.queueAddDtToYmd)&&!isNullOrEmpty($scope.head.queueAddDtToTime)?(optionMessageControl.hide($scope,"queueAddDtToYmd"),optionMessageControl.show($scope,"queueAddDtToYmd",$filter("owfMessage")("queueAddDtConditionallyRequiredError",[$scope.item[$scope.screenCd].queueAddDtToTime.itemNm]))):(optionMessageControl.hide($scope,"queueAddDtToYmd"),optionMessageControl.hide($scope,"queueAddDtToTime"),owsCommon.syncExec(function(){checkFromTo()}))},$scope.changeQueueAddDtToTime=function(){$scope.changeQueueAddDtToYmd()},$scope.reprint=function(){var modalInstance=printFactory.modalRePrint($scope.gridOptions.gridApi.selection.getSelectedRows()[0]);modalInstance.result.then(function(printParam){var request={};request.data={},request.data.searchCondition=$scope.searchCondition,request.printBasicData=printParam.printBasicData,statusInfo.isSuccessAndShowMessage(printParam,"searchinputform")&&$scope.search();
})},$scope.printRequestHistBrowse=function(){printRequestHistBrowseModalService.displayModalModeLatest($scope.gridOptions.gridApi.selection.getSelectedRows()[0])},$scope.initScreen()}]);